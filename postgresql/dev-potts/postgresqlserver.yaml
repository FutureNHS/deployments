apiVersion: azure.microsoft.com/v1alpha1
kind: PostgreSQLServer
metadata:
  # Must be globally unique across the whole of azure.
  name: fnhs-postgresqlserver-kratos-potts
  namespace: kratos
spec:
  location: westeurope
  resourceGroup: platform-dev-potts
  serverVersion: "10"
  sslEnforcement: Enabled
  sku:
    name: B_Gen5_2
    tier: Basic
    family: Gen5
    size: "51200"
    capacity: 2
  # Use the field below to optionally specify a different keyvault
  # to store the server admin credential secrets in
  #keyVaultToStoreSecrets: asoSecretKeyVault
---
apiVersion: azure.microsoft.com/v1alpha1
kind: PostgreSQLFirewallRule
metadata:
  name: postgresqlfirewallrule-wfh
  namespace: kratos
spec:
  resourceGroup: platform-dev-potts
  server: fnhs-postgresqlserver-kratos-potts
  startIpAddress: 0.0.0.0
  endIpAddress: 0.0.0.0
---
# Sneaky postgresql db in the hello-world namespace.
# Writing it here because it reduces my iteration time (hello-world takes 10mins to build)
apiVersion: azure.microsoft.com/v1alpha1
kind: PostgreSQLDatabase
metadata:
  name: postgresqldatabase-kratos
  namespace: kratos
spec:
  resourceGroup: platform-dev-potts
  server: fnhs-postgresqlserver-kratos-potts
---
# https://github.com/Azure/azure-service-operator/blob/217c62e5f65c94b753fa62c9a87eda210c1a8e5f/config/samples/azure_v1alpha1_postgresqluser.yaml
apiVersion: azure.microsoft.com/v1alpha1
kind: PostgreSQLUser
metadata:
  name: psqluser-kratos
  namespace: kratos
spec:
  server: fnhs-postgresqlserver-kratos-potts
  dbName: postgresqldatabase-kratos
  resourceGroup: platform-dev-potts
  # The Azure Database for PostgreSQL server is created with the 3 default roles defined.
  # azure_pg_admin
  # azure_superuser
  # your server admin user
  roles:
    - "azure_pg_admin"
    # Specify a specific username for the user
  username: psqluser-kratos
  # Specify adminSecret and adminSecretKeyVault if you want to
  # read the PSQL server admin creds from a specific keyvault secret
  # adminSecret: postgresqlserver-sample
  # adminSecretKeyVault: asokeyvault
  # Use the field below to optionally specify a different keyvault
  # to store the secrets in
  # keyVaultToStoreSecrets: asokeyvault
